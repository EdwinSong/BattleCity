# BattleCity 测试脚本使用指南

本指南将详细说明如何使用 `test_blockly_sequence.js` 测试脚本验证 BattleCity 程序控制坦克的功能。

## 方法一：直接在浏览器控制台运行

这是最简单快速的测试方法，不需要修改任何文件。

### 步骤

1. **启动本地服务器**
   ```bash
   python -m http.server 8000
   ```

2. **打开游戏**
   - 在浏览器中访问：`http://localhost:8000/BattleCity.html`
   - 等待游戏加载完成

3. **打开浏览器开发者工具**
   - 按 `F12` 键或右键点击页面，选择"检查元素"
   - 切换到"控制台"(Console)标签

4. **复制测试代码**
   - 打开 `test_blockly_sequence.js` 文件
   - 复制所有代码内容

5. **粘贴并执行**
   - 将代码粘贴到浏览器控制台中
   - 按 `Enter` 键执行代码

6. **观察测试结果**
   - 控制台将显示测试序列的执行日志
   - 游戏中的坦克将按照预设序列执行动作

## 方法二：集成到 BattleCity.html 文件中

这种方法将测试脚本永久添加到游戏中，便于反复测试。

### 步骤

1. **打开 BattleCity.html 文件**
   ```bash
   # 使用文本编辑器打开
   notepad BattleCity.html
   ```

2. **添加测试脚本引用**
   - 在文件末尾，`</body>` 标签之前添加：
     ```html
     <!-- 测试脚本 -->
     <script type="text/javascript" src="test_blockly_sequence.js"></script>
     ```

3. **保存并重新加载游戏**
   - 保存文件
   - 在浏览器中刷新页面：`http://localhost:8000/BattleCity.html`

4. **执行测试**
   - 打开浏览器控制台
   - 输入并执行：`testBattleCityControl()`

5. **观察测试结果**
   - 控制台将显示测试序列的执行日志
   - 游戏中的坦克将按照预设序列执行动作

## 方法三：修改 Blockly 生成的代码

这种方法将测试序列作为 Blockly 程序运行，模拟真实的用户编程体验。

### 步骤

1. **启动游戏**
   - 确保本地服务器正在运行：`python -m http.server 8000`
   - 打开浏览器访问：`http://localhost:8000/BattleCity.html`

2. **进入 Blockly 编辑器**
   - 在游戏界面中找到 Blockly 编程区域

3. **创建简单程序**
   - 拖拽一个"开始编程关卡"块到工作区
   - 点击"运行代码"按钮生成初始代码

4. **修改生成的代码**
   - 切换到 Ace 代码编辑器
   - 将默认生成的代码替换为 `test_blockly_sequence.js` 中的内容

5. **运行测试**
   - 点击"运行代码"按钮
   - 观察坦克行为和控制台日志

## 测试功能说明

测试脚本将验证以下功能：

1. **游戏启动检测**：自动检测游戏是否已开始，或等待游戏开始事件
2. **基本移动控制**：向上、向左、向右移动和停止移动
3. **射击控制**：射击和停止射击
4. **时间延迟**：在动作之间添加指定时间间隔
5. **条件判断**：根据与敌人的距离执行不同动作
6. **事件监听**：敌人接近时自动触发防御行为

## 测试结果验证

### 控制台输出

执行测试后，控制台将显示类似以下的日志：

```
开始执行测试序列...
向上移动2秒
停止移动
射击1秒
停止射击
向左移动2秒
停止移动
延迟1秒
向右移动2秒
停止移动
与最近敌人的距离: 150 像素
敌人距离正常，向下移动
停止移动
检测到敌人接近，距离: 80 像素
执行防御操作：停止移动并射击
停止射击
```

### 坦克行为

观察游戏中的坦克行为是否与以下预期一致：

1. 坦克进入第6关
2. 向上移动约2秒，然后停止
3. 射击约1秒，然后停止射击
4. 向左移动约2秒，然后停止
5. 等待约1秒
6. 向右移动约2秒，然后停止
7. 根据敌人距离执行条件移动
8. 当敌人接近时，停止移动并射击

## 问题排查

### 常见问题及解决方法

1. **坦克不移动**
   - 检查游戏是否已开始
   - 确认控制台没有报错
   - 尝试重新加载页面

2. **射击功能不工作**
   - 确认坦克有足够的射击冷却时间
   - 检查射击块是否正确连接

3. **条件判断不执行**
   - 检查条件表达式是否正确
   - 确认敌人是否在测试范围内

4. **控制台显示"tank is not defined"**
   - 确保游戏已完全加载
   - 尝试在页面加载完成后再执行测试代码

5. **控制台显示"Game is not defined"**
   - 确保 BattleCity.html 文件已正确加载所有游戏组件
   - 检查是否有脚本加载错误

## 调试技巧

1. **逐行测试**：将测试脚本分解为小部分，逐行执行以定位问题
2. **添加日志**：在关键位置添加 `console.log()` 语句跟踪执行流程
3. **检查对象状态**：在控制台中输入 `tank` 查看坦克对象的当前状态
4. **验证事件监听**：检查事件订阅是否成功

## 扩展测试

您可以根据需要修改测试脚本，测试更多功能：

1. **调整移动时间**：修改 `setTimeout()` 函数的时间参数
2. **添加更多移动序列**：组合不同的移动和射击动作
3. **修改条件阈值**：调整敌人距离的判断条件
4. **添加新功能测试**：尝试使用其他未测试的功能

## 注意事项

1. **游戏状态**：确保在测试前游戏已完全加载
2. **浏览器兼容性**：建议使用 Chrome 或 Firefox 浏览器
3. **性能影响**：大量的日志输出可能会影响游戏性能
4. **清理**：测试完成后，可移除集成到 HTML 文件中的测试脚本引用

通过这些测试方法，您可以全面验证 BattleCity 程序控制坦克功能的实现状态，并为进一步开发提供参考。