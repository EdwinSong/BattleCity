# BattleCity Blockly 程序控制测试指南

## 一、测试序列概述

这个测试序列将验证BattleCity游戏中程序控制坦克的核心功能，包括：
- 基本移动控制
- 射击控制
- 时间延迟控制
- 条件判断（基于敌人距离）
- 敌人接近事件监听

## 二、Blockly 块组合步骤

### 1. 启动程序
从Blockly工具栏中拖拽以下块并连接：

```
[开始编程关卡]
```

### 2. 添加基础移动序列
在开始块下方连接：

```
[向上移动]
  |
[延迟 2000 毫秒]
  |
[停止移动]
  |
[射击]
  |
[延迟 1000 毫秒]
  |
[停止射击]
  |
[向左移动]
  |
[延迟 2000 毫秒]
  |
[停止移动]
  |
[延迟 1000 毫秒]
  |
[向右移动]
  |
[延迟 2000 毫秒]
  |
[停止移动]
  |
[延迟 1000 毫秒]
```

### 3. 添加条件判断（基于敌人距离）
在移动序列下方连接：

```
[如果 [获取最近敌人距离] < [100]]
  |
  +---[向后移动]
        |
        [延迟 1000 毫秒]
        |
        [停止移动]
  |
[否则]
  |
  +---[向下移动]
        |
        [延迟 2000 毫秒]
        |
        [停止移动]
```

### 4. 添加敌人接近事件监听
在条件判断下方连接：

```
[当敌人接近时]
  |
  +---[停止移动]
        |
        [射击]
        |
        [延迟 2000 毫秒]
        |
        [停止射击]
```

## 三、完整 Blockly 程序结构

```
[开始编程关卡]
  |
[向上移动]
  |
[延迟 2000 毫秒]
  |
[停止移动]
  |
[射击]
  |
[延迟 1000 毫秒]
  |
[停止射击]
  |
[向左移动]
  |
[延迟 2000 毫秒]
  |
[停止移动]
  |
[延迟 1000 毫秒]
  |
[向右移动]
  |
[延迟 2000 毫秒]
  |
[停止移动]
  |
[延迟 1000 毫秒]
  |
[如果 [获取最近敌人距离] < [100]]
  |
  +---[向后移动]
        |
        [延迟 1000 毫秒]
        |
        [停止移动]
  |
[否则]
  |
  +---[向下移动]
        |
        [延迟 2000 毫秒]
        |
        [停止移动]
  |
[当敌人接近时]
  |
  +---[停止移动]
        |
        [射击]
        |
        [延迟 2000 毫秒]
        |
        [停止射击]
```

## 四、测试步骤

### 1. 加载游戏
1. 确保本地服务器正在运行：`python -m http.server 8000`
2. 打开浏览器访问：`http://localhost:8000/BattleCity.html`

### 2. 进入编程模式
1. 在游戏界面中找到Blockly编辑器
2. 按照上述步骤组合测试序列

### 3. 运行测试程序
1. 点击"运行代码"按钮
2. 观察坦克行为：
   - 坦克应进入第6关
   - 执行向上→停止→射击→停止射击→向左→停止→向右→停止的移动序列
   - 根据敌人距离执行条件移动
   - 当敌人接近时，坦克应停止移动并射击

### 4. 监控执行过程
1. 打开浏览器开发者工具（F12）
2. 切换到"控制台"标签
3. 观察测试序列的执行日志
4. 检查是否有错误信息

## 五、测试功能对应关系

| 测试功能 | 对应Blockly块 | 已实现状态 | 预期行为 |
|---------|--------------|-----------|---------|
| 基本移动 | 移动块 | ✅ | 坦克按照指定方向移动 |
| 停止移动 | 停止移动块 | ✅ | 坦克停止所有移动 |
| 射击控制 | 射击/停止射击块 | ✅ | 坦克发射子弹/停止发射 |
| 时间延迟 | 延迟块 | ✅ | 按照指定时间暂停执行 |
| 条件判断 | 如果/否则块 | ✅ | 根据敌人距离执行不同动作 |
| 距离检测 | 获取最近敌人距离块 | ✅ | 返回与最近敌人的距离 |
| 事件监听 | 当敌人接近时块 | ✅ | 敌人接近时触发防御动作 |

## 六、调试与问题排查

### 常见问题
1. **坦克不移动**
   - 检查游戏是否已开始
   - 确认块连接正确
   - 查看控制台是否有错误信息

2. **射击功能不工作**
   - 检查射击块是否正确连接
   - 确认坦克有足够的射击冷却时间

3. **条件判断不执行**
   - 检查条件表达式是否正确
   - 确认获取距离的功能正常工作

4. **事件监听不触发**
   - 检查事件块是否正确连接
   - 确认敌人在附近触发事件

### 调试技巧
1. 使用浏览器控制台查看详细日志
2. 逐块测试功能，确认每一步都能正常工作
3. 调整延迟时间，观察不同时间间隔的效果
4. 尝试简化测试序列，定位问题所在

## 七、扩展测试建议

### 1. 测试更多移动组合
```
[向上移动] → [延迟 1500] → [向右移动] → [延迟 1000] → [向下移动]
```

### 2. 测试复杂条件判断
```
[如果 [获取最近敌人距离] < [50]] → [向后移动]
[否则如果 [获取最近敌人距离] < [100]] → [射击]
[否则] → [继续移动]
```

### 3. 测试多事件组合
```
[当敌人接近时] → [停止移动] → [射击]
[当敌人离开时] → [停止射击] → [继续移动]
```

## 八、结论

这个测试序列覆盖了BattleCity当前已实现的大部分程序控制功能。通过运行这个序列，您可以验证：

1. 基本移动和射击控制是否正常工作
2. 时间延迟和条件判断是否准确
3. 距离感知和事件监听是否有效

如果所有功能都能正常工作，说明BattleCity的程序控制API已经达到了基本可用的状态，可以用于进一步的开发和扩展。